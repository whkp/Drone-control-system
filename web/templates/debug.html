<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•é¡µé¢ - æ— äººæœºæ§åˆ¶ç³»ç»Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .warning { background-color: #fff3cd; color: #856404; }
        .log { background-color: #f8f9fa; padding: 10px; margin: 10px 0; border-left: 3px solid #007bff; font-family: monospace; }
    </style>
</head>
<body>
    <h1>ğŸš æ— äººæœºæ§åˆ¶ç³»ç»Ÿ - è°ƒè¯•é¡µé¢</h1>
    
    <div id="status" class="status warning">æ­£åœ¨åˆå§‹åŒ–...</div>
    
    <h2>æµ‹è¯•ç»“æœ</h2>
    <div id="tests"></div>
    
    <h2>æ—¥å¿—</h2>
    <div id="logs"></div>

    <script>
        const API_BASE = 'http://localhost:8080/api/v1';
        const MONITOR_BASE = 'http://localhost:50053/api/monitoring';
        let websocket = null;
        
        function log(message, type = 'info') {
            console.log(message);
            const logs = document.getElementById('logs');
            const div = document.createElement('div');
            div.className = 'log';
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logs.appendChild(div);
            logs.scrollTop = logs.scrollHeight;
        }
        
        function updateStatus(message, success = null) {
            const status = document.getElementById('status');
            status.textContent = message;
            if (success === true) {
                status.className = 'status success';
            } else if (success === false) {
                status.className = 'status error';
            } else {
                status.className = 'status warning';
            }
        }
        
        function addTest(name, result, details = '') {
            const tests = document.getElementById('tests');
            const div = document.createElement('div');
            div.className = result ? 'status success' : 'status error';
            div.innerHTML = `<strong>${name}</strong>: ${result ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'} ${details}`;
            tests.appendChild(div);
        }
        
        async function runTests() {
            log('å¼€å§‹è¿è¡Œæµ‹è¯•...');
            updateStatus('è¿è¡Œæµ‹è¯•ä¸­...');
            
            // æµ‹è¯•1: API Gateway
            try {
                const response = await axios.get('http://localhost:8080/health');
                addTest('API Gatewayå¥åº·æ£€æŸ¥', true, `çŠ¶æ€: ${response.status}`);
                log('API Gatewayæµ‹è¯•æˆåŠŸ');
            } catch (error) {
                addTest('API Gatewayå¥åº·æ£€æŸ¥', false, error.message);
                log('API Gatewayæµ‹è¯•å¤±è´¥: ' + error.message);
            }
            
            // æµ‹è¯•2: Monitor Service
            try {
                const response = await axios.get('http://localhost:50053/health');
                addTest('ç›‘æ§æœåŠ¡å¥åº·æ£€æŸ¥', true, `çŠ¶æ€: ${response.status}`);
                log('ç›‘æ§æœåŠ¡æµ‹è¯•æˆåŠŸ');
            } catch (error) {
                addTest('ç›‘æ§æœåŠ¡å¥åº·æ£€æŸ¥', false, error.message);
                log('ç›‘æ§æœåŠ¡æµ‹è¯•å¤±è´¥: ' + error.message);
            }
            
            // æµ‹è¯•3: WebSocketè¿æ¥
            try {
                log('å°è¯•WebSocketè¿æ¥...');
                websocket = new WebSocket('ws://localhost:50053/ws/monitoring');
                
                websocket.onopen = function() {
                    addTest('WebSocketè¿æ¥', true, 'è¿æ¥æˆåŠŸ');
                    log('WebSocketè¿æ¥æˆåŠŸ');
                    updateStatus('æ‰€æœ‰æµ‹è¯•å®Œæˆ - WebSocketå·²è¿æ¥', true);
                };
                
                websocket.onerror = function(error) {
                    addTest('WebSocketè¿æ¥', false, 'WebSocketé”™è¯¯');
                    log('WebSocketè¿æ¥é”™è¯¯: ' + error);
                    updateStatus('æµ‹è¯•å®Œæˆ - WebSocketè¿æ¥å¤±è´¥', false);
                };
                
                websocket.onclose = function() {
                    log('WebSocketè¿æ¥å·²å…³é—­');
                };
                
                // 5ç§’è¶…æ—¶
                setTimeout(() => {
                    if (websocket.readyState !== WebSocket.OPEN) {
                        addTest('WebSocketè¿æ¥', false, 'è¿æ¥è¶…æ—¶');
                        log('WebSocketè¿æ¥è¶…æ—¶');
                        updateStatus('æµ‹è¯•å®Œæˆ - WebSocketè¿æ¥è¶…æ—¶', false);
                    }
                }, 5000);
                
            } catch (error) {
                addTest('WebSocketè¿æ¥', false, error.message);
                log('WebSocketåˆå§‹åŒ–å¤±è´¥: ' + error.message);
                updateStatus('æµ‹è¯•å®Œæˆ - WebSocketåˆå§‹åŒ–å¤±è´¥', false);
            }
        }
        
        // é¡µé¢åŠ è½½åè¿è¡Œæµ‹è¯•
        document.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>
