<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŠ¶æ€æ›´æ–°æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status-container { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-dot.connected { background-color: #10B981; }
        .status-dot.connecting { 
            background-color: #F59E0B; 
            animation: pulse 1.5s infinite;
        }
        .status-dot.disconnected { background-color: #EF4444; }
        .status-dot.warning { background-color: #F59E0B; }
        .status-dot.error { background-color: #EF4444; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .log { 
            background: #f8f9fa; 
            padding: 10px; 
            border-radius: 4px; 
            margin: 10px 0;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>è¿æ¥çŠ¶æ€æ›´æ–°æµ‹è¯•</h1>
    
    <div class="status-container">
        <h3>æ¨¡æ‹Ÿä¸»é¡µé¢çŠ¶æ€æ˜¾ç¤º</h3>
        <div class="flex items-center">
            <span class="status-dot" id="connectionStatus"></span>
            <span id="connectionText">è¿æ¥ä¸­...</span>
        </div>
    </div>
    
    <div>
        <button class="btn" onclick="testStatuses()">æµ‹è¯•æ‰€æœ‰çŠ¶æ€</button>
        <button class="btn" onclick="simulateInitialization()">æ¨¡æ‹Ÿåˆå§‹åŒ–æµç¨‹</button>
        <button class="btn" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    </div>
    
    <div id="log" class="log">å‡†å¤‡æµ‹è¯•...</div>

    <script>
        function log(message) {
            const logEl = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logEl.textContent += `[${timestamp}] ${message}\n`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            document.getElementById('log').textContent = '';
        }
        
        // æ›´æ–°è¿æ¥çŠ¶æ€ - å¤åˆ¶ä¸»é¡µé¢çš„é€»è¾‘
        function updateConnectionStatus(status, type = 'info') {
            const statusElement = document.getElementById('connectionStatus');
            const textElement = document.getElementById('connectionText');
            
            log(`å°è¯•æ›´æ–°çŠ¶æ€: ${status} (${type})`);
            
            if (!statusElement) {
                log('âŒ æœªæ‰¾åˆ°connectionStatuså…ƒç´ ');
                return;
            }
            
            if (!textElement) {
                log('âŒ æœªæ‰¾åˆ°connectionTextå…ƒç´ ');
                return;
            }
            
            // æ›´æ–°çŠ¶æ€æ–‡æœ¬
            textElement.textContent = status;
            log(`âœ… æ–‡æœ¬å·²æ›´æ–°ä¸º: ${status}`);
            
            // ç§»é™¤æ‰€æœ‰çŠ¶æ€ç±»
            statusElement.classList.remove('connected', 'connecting', 'disconnected', 'warning', 'error', 'success');
            
            // æ ¹æ®ç±»å‹æ·»åŠ ç›¸åº”çš„ç±»
            switch(type) {
                case 'success':
                    statusElement.classList.add('connected');
                    log(`âœ… æ·»åŠ æ ·å¼ç±»: connected`);
                    break;
                case 'warning':
                    statusElement.classList.add('warning');
                    log(`âœ… æ·»åŠ æ ·å¼ç±»: warning`);
                    break;
                case 'error':
                    statusElement.classList.add('error');
                    log(`âœ… æ·»åŠ æ ·å¼ç±»: error`);
                    break;
                case 'connecting':
                    statusElement.classList.add('connecting');
                    log(`âœ… æ·»åŠ æ ·å¼ç±»: connecting`);
                    break;
                default:
                    statusElement.classList.add('disconnected');
                    log(`âœ… æ·»åŠ æ ·å¼ç±»: disconnected`);
            }
        }
        
        function testStatuses() {
            log('ğŸ§ª å¼€å§‹æµ‹è¯•æ‰€æœ‰çŠ¶æ€...');
            
            const statuses = [
                ['è¿æ¥ä¸­...', 'connecting'],
                ['å·²è¿æ¥', 'success'],
                ['ç¦»çº¿æ¨¡å¼', 'warning'],
                ['è¿æ¥å¤±è´¥', 'error'],
                ['æ–­å¼€è¿æ¥', 'disconnected']
            ];
            
            let index = 0;
            function nextStatus() {
                if (index < statuses.length) {
                    const [status, type] = statuses[index];
                    updateConnectionStatus(status, type);
                    index++;
                    setTimeout(nextStatus, 1500);
                } else {
                    log('ğŸ‰ æ‰€æœ‰çŠ¶æ€æµ‹è¯•å®Œæˆ');
                }
            }
            
            nextStatus();
        }
        
        async function simulateInitialization() {
            log('ğŸš€ æ¨¡æ‹Ÿä¸»é¡µé¢åˆå§‹åŒ–æµç¨‹...');
            
            // æ­¥éª¤1: åˆå§‹çŠ¶æ€
            updateConnectionStatus('æ­£åœ¨åˆå§‹åŒ–...', 'connecting');
            await sleep(1000);
            
            // æ­¥éª¤2: æ¨¡æ‹Ÿæ•°æ®åŠ è½½æˆåŠŸ
            log('ğŸ“Š æ¨¡æ‹Ÿä»ªè¡¨æ¿æ•°æ®åŠ è½½...');
            await sleep(800);
            log('âœ… ä»ªè¡¨æ¿æ•°æ®åŠ è½½å®Œæˆ');
            updateConnectionStatus('å·²è¿æ¥', 'success');
            await sleep(500);
            
            // æ­¥éª¤3: æ¨¡æ‹Ÿæ— äººæœºåˆ—è¡¨åŠ è½½
            log('ğŸš æ¨¡æ‹Ÿæ— äººæœºåˆ—è¡¨åŠ è½½...');
            await sleep(600);
            log('âœ… æ— äººæœºåˆ—è¡¨åŠ è½½å®Œæˆ');
            
            // æ­¥éª¤4: æ¨¡æ‹ŸWebSocketè¿æ¥å°è¯•
            log('ğŸ”Œ æ¨¡æ‹ŸWebSocketè¿æ¥...');
            await sleep(1000);
            
            // éšæœºæˆåŠŸæˆ–å¤±è´¥
            if (Math.random() > 0.5) {
                log('âœ… WebSocketè¿æ¥æˆåŠŸ');
                updateConnectionStatus('å®æ—¶è¿æ¥', 'success');
            } else {
                log('âš ï¸ WebSocketè¿æ¥å¤±è´¥ï¼Œåˆ‡æ¢åˆ°ç¦»çº¿æ¨¡å¼');
                updateConnectionStatus('ç¦»çº¿æ¨¡å¼', 'warning');
            }
            
            log('ğŸ‰ åˆå§‹åŒ–æµç¨‹å®Œæˆï¼');
        }
        
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // é¡µé¢åŠ è½½æ—¶ç«‹å³æµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ“‹ é¡µé¢å·²åŠ è½½ï¼Œå¼€å§‹æµ‹è¯•');
            log('ğŸ” æ£€æŸ¥DOMå…ƒç´ ...');
            
            const statusEl = document.getElementById('connectionStatus');
            const textEl = document.getElementById('connectionText');
            
            log(`connectionStatuså…ƒç´ : ${statusEl ? 'âœ… æ‰¾åˆ°' : 'âŒ æœªæ‰¾åˆ°'}`);
            log(`connectionTextå…ƒç´ : ${textEl ? 'âœ… æ‰¾åˆ°' : 'âŒ æœªæ‰¾åˆ°'}`);
            
            if (statusEl && textEl) {
                log('ğŸ¯ DOMå…ƒç´ æ­£å¸¸ï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•çŠ¶æ€æ›´æ–°');
                setTimeout(() => simulateInitialization(), 1000);
            } else {
                log('âŒ DOMå…ƒç´ ç¼ºå¤±ï¼Œæ— æ³•è¿›è¡ŒçŠ¶æ€æ›´æ–°æµ‹è¯•');
            }
        });
    </script>
</body>
</html>
