<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户登录 - 无人机控制系统</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-blue-900 via-blue-800 to-blue-700 min-h-screen flex items-center justify-center">
    <!-- 背景装饰 -->
    <div class="absolute inset-0 overflow-hidden">
        <div class="absolute -top-1/2 -right-1/2 w-full h-full bg-white opacity-5 rounded-full transform rotate-45"></div>
        <div class="absolute -bottom-1/2 -left-1/2 w-full h-full bg-white opacity-5 rounded-full transform -rotate-45"></div>
    </div>
    
    <!-- 登录卡片 -->
    <div class="relative z-10 w-full max-w-md">
        <div class="bg-white rounded-2xl shadow-2xl p-8">
            <!-- Logo和标题 -->
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-full mb-4">
                    <i class="fas fa-helicopter text-white text-2xl"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-900 mb-2">无人机控制系统</h1>
                <p class="text-gray-600">管理控制台登录</p>
            </div>
            
            <!-- 登录表单 -->
            <form id="loginForm" class="space-y-6">
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-user mr-2"></i>用户名
                    </label>
                    <input 
                        type="text" 
                        id="username" 
                        name="username" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                        placeholder="请输入用户名"
                        required
                    >
                </div>
                
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-lock mr-2"></i>密码
                    </label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                        placeholder="请输入密码"
                        required
                    >
                </div>
                
                <div class="flex items-center justify-between">
                    <label class="flex items-center">
                        <input type="checkbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                        <span class="ml-2 text-sm text-gray-600">记住登录</span>
                    </label>
                    <a href="#" class="text-sm text-blue-600 hover:text-blue-800">忘记密码？</a>
                </div>
                
                <button 
                    type="submit" 
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center"
                    id="loginButton"
                >
                    <i class="fas fa-sign-in-alt mr-2"></i>
                    <span>登录</span>
                </button>
            </form>
            
            <!-- 演示模式 -->
            <div class="mt-6 pt-6 border-t border-gray-200">
                <!-- 测试登录按钮 -->
                <button 
                    onclick="testLogin()" 
                    class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center mb-3"
                >
                    <i class="fas fa-vial mr-2"></i>
                    <span>测试登录（无需密码）</span>
                </button>
                
                <!-- 演示模式按钮 -->
                <button 
                    onclick="enterDemoMode()" 
                    class="w-full bg-gray-600 hover:bg-gray-700 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center"
                >
                    <i class="fas fa-play-circle mr-2"></i>
                    <span>演示模式</span>
                </button>
                <p class="text-xs text-gray-500 text-center mt-2">
                    测试登录：快速进入系统测试功能<br>
                    演示模式：无需登录，直接体验系统功能
                </p>
            </div>
        </div>
        
        <!-- 版本信息 -->
        <div class="text-center mt-6 text-white text-sm opacity-75">
            <p>版本 v1.1.0-beta | © 2025 无人机控制系统</p>
        </div>
    </div>
    
    <script>
        // 登录表单处理
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const loginButton = document.getElementById('loginButton');
            
            // 显示加载状态
            loginButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>登录中...';
            loginButton.disabled = true;
            
            try {
                // 模拟登录API调用
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // 这里应该调用真实的登录API
                const response = await fetch('/proxy/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: username,
                        password: password
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    // 存储token
                    localStorage.setItem('authToken', data.token || 'demo-token');
                    localStorage.setItem('currentUser', username);
                    
                    // 跳转到主页
                    window.location.href = '/';
                } else {
                    throw new Error('登录失败');
                }
                
            } catch (error) {
                console.error('登录失败:', error);
                showError('登录失败，请检查用户名和密码');
            } finally {
                // 恢复按钮状态
                loginButton.innerHTML = '<i class="fas fa-sign-in-alt mr-2"></i>登录';
                loginButton.disabled = false;
            }
        });
        
        // 测试登录
        function testLogin() {
            showSuccess('测试登录成功！正在跳转...');
            localStorage.setItem('authToken', 'test-token-' + Date.now());
            localStorage.setItem('currentUser', '测试用户');
            localStorage.setItem('loginMode', 'test');
            
            setTimeout(() => {
                window.location.href = '/';
            }, 1000);
        }
        
        // 演示模式
        function enterDemoMode() {
            showSuccess('进入演示模式！正在跳转...');
            localStorage.setItem('authToken', 'demo-token');
            localStorage.setItem('currentUser', '演示用户');
            localStorage.setItem('loginMode', 'demo');
            
            setTimeout(() => {
                window.location.href = '/';
            }, 1000);
        }
        
        // 错误提示
        function showError(message) {
            showNotification(message, 'error');
        }
        
        // 成功提示
        function showSuccess(message) {
            showNotification(message, 'success');
        }
        
        // 通用提示函数
        function showNotification(message, type = 'error') {
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
            const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-triangle';
            
            const notificationDiv = document.createElement('div');
            notificationDiv.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300 transform translate-x-full`;
            notificationDiv.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${icon} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notificationDiv);
            
            // 显示动画
            setTimeout(() => {
                notificationDiv.classList.remove('translate-x-full');
            }, 100);
            
            // 3秒后隐藏
            setTimeout(() => {
                notificationDiv.classList.add('translate-x-full');
                setTimeout(() => {
                    if (document.body.contains(notificationDiv)) {
                        document.body.removeChild(notificationDiv);
                    }
                }, 300);
            }, 3000);
        }
        
        // 检查是否已登录（排除演示token）
        const existingToken = localStorage.getItem('authToken');
        if (existingToken && existingToken !== 'demo-token') {
            window.location.href = '/';
        }
        
        // Enter键登录
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('loginForm').dispatchEvent(new Event('submit'));
            }
        });
    </script>
</body>
</html>
