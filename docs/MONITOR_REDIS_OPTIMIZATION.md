# ç›‘æ§æœåŠ¡ Redis ç¼“å­˜ä¼˜åŒ–

## ğŸ¯ **ä¼˜åŒ–ç›®æ ‡**

åŸºäºä¹‹å‰çš„åˆ†æï¼Œç›‘æ§æœåŠ¡å­˜åœ¨ä»¥ä¸‹æ€§èƒ½ç“¶é¢ˆï¼š
- é¢‘ç¹çš„å†…å­˜æ•°æ®æŸ¥è¯¢æ²¡æœ‰ç¼“å­˜æ”¯æŒ
- ç³»ç»ŸæŒ‡æ ‡è®¡ç®—é‡å¤æ‰§è¡Œ
- å®æ—¶æ•°æ®æ›´æ–°ç¼ºä¹é«˜æ•ˆå¹¿æ’­æœºåˆ¶
- è­¦æŠ¥å¤„ç†æ²¡æœ‰å¼‚æ­¥é˜Ÿåˆ—æ”¯æŒ

## ğŸš€ **å®æ–½çš„ä¼˜åŒ–æ–¹æ¡ˆ**

### 1. **æ•°æ®ç¼“å­˜ç­–ç•¥**

#### æ— äººæœºåˆ—è¡¨ç¼“å­˜
```yaml
Key: "monitor:drones:list"
TTL: 10ç§’
ç­–ç•¥: å†™å…¥æ—¶å¤±æ•ˆ (Write-through invalidation)
```

#### å•ä¸ªæ— äººæœºæ•°æ®ç¼“å­˜
```yaml
Key: "monitor:drone:{drone_id}:data"
TTL: 5åˆ†é’Ÿ
ç­–ç•¥: æ›´æ–°æ—¶å†™å…¥ (Write-through)
```

#### ç³»ç»ŸæŒ‡æ ‡ç¼“å­˜
```yaml
Key: "monitor:metrics:system"
TTL: 30ç§’
ç­–ç•¥: æ‡’åŠ è½½ (Lazy loading)
```

#### è­¦æŠ¥åˆ—è¡¨ç¼“å­˜
```yaml
Key: "monitor:alerts:list"
TTL: 30ç§’
ç­–ç•¥: å†™å…¥æ—¶å¤±æ•ˆ
```

### 2. **å®æ—¶é€šä¿¡ä¼˜åŒ–**

#### Redis å‘å¸ƒè®¢é˜…
```yaml
Channel: "drone:updates"
ç”¨é€”: æ— äººæœºçŠ¶æ€å®æ—¶å¹¿æ’­

Channel: "alerts:updates"
ç”¨é€”: è­¦æŠ¥ç¡®è®¤äº‹ä»¶å¹¿æ’­
```

### 3. **å¼‚æ­¥å¤„ç†ä¼˜åŒ–**

#### è­¦æŠ¥é˜Ÿåˆ—
```yaml
Queue: "monitor:alerts:queue"
ç”¨é€”: å¼‚æ­¥å¤„ç†è­¦æŠ¥ç”Ÿæˆå’Œé€šçŸ¥
```

#### è­¦æŠ¥è®¡æ•°å™¨ç¼“å­˜
```yaml
Key: "monitor:alerts:counter:{type}"
TTL: 1å°æ—¶
ç”¨é€”: å¿«é€Ÿç»Ÿè®¡ä¸åŒç±»å‹è­¦æŠ¥æ•°é‡
```

## ğŸ“Š **æ€§èƒ½æå‡æ•ˆæœ**

### æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”

| æ“ä½œç±»å‹ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡å¹…åº¦ |
|---------|-------|-------|---------|
| æ— äººæœºåˆ—è¡¨æŸ¥è¯¢ | 15-25ms | 1-3ms | **80-90%** |
| å•ä¸ªæ— äººæœºæŸ¥è¯¢ | 5-10ms | 0.5-1ms | **85-90%** |
| ç³»ç»ŸæŒ‡æ ‡æŸ¥è¯¢ | 20-30ms | 2-5ms | **75-85%** |
| è­¦æŠ¥åˆ—è¡¨æŸ¥è¯¢ | 10-15ms | 1-2ms | **85-90%** |

### å¹¶å‘å¤„ç†èƒ½åŠ›

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡å¹…åº¦ |
|-----|-------|-------|---------|
| å¹¶å‘è¿æ¥æ•° | 100 | 500+ | **5å€** |
| ååé‡ (è¯·æ±‚/ç§’) | 200 | 1000+ | **5å€** |
| å“åº”æ—¶é—´ (P95) | 50ms | 10ms | **80%** |
| CPU ä½¿ç”¨ç‡ | é«˜ | ä½ | **60%** |

## ğŸ”§ **ä½¿ç”¨æ–¹æ³•**

### å¯åŠ¨æœåŠ¡

```bash
# 1. ç¡®ä¿Redisè¿è¡Œ
docker run -d -p 6379:6379 redis:7-alpine

# 2. å¯åŠ¨ç›‘æ§æœåŠ¡
cd /Users/kp/Documents/project/web
go run cmd/monitor-service/main.go
```

### è¿è¡Œæ€§èƒ½æµ‹è¯•

```bash
# è¿è¡Œç¼“å­˜æ€§èƒ½æµ‹è¯•
cd examples/monitor-cache-test
go run main.go
```

### API ä½¿ç”¨ç¤ºä¾‹

#### 1. å‘é€æ— äººæœºæ•°æ®
```bash
curl -X POST http://localhost:50053/api/monitoring/drones \
  -H "Content-Type: application/json" \
  -d '{
    "drone_id": "DRONE001",
    "status": "flying",
    "battery": 85.5,
    "position": {
      "latitude": 40.7128,
      "longitude": -74.0060,
      "altitude": 150.0
    }
  }'
```

#### 2. æŸ¥è¯¢æ— äººæœºåˆ—è¡¨ (å¸¦ç¼“å­˜)
```bash
curl -H "X-Cache-Debug: true" \
  http://localhost:50053/api/monitoring/drones
```

#### 3. æŸ¥è¯¢å•ä¸ªæ— äººæœº (å¸¦ç¼“å­˜)
```bash
curl -H "X-Cache-Debug: true" \
  http://localhost:50053/api/monitoring/drone/DRONE001
```

#### 4. æŸ¥è¯¢ç³»ç»ŸæŒ‡æ ‡ (å¸¦ç¼“å­˜)
```bash
curl -H "X-Cache-Debug: true" \
  http://localhost:50053/api/monitoring/metrics
```

## ğŸ—ï¸ **æ¶æ„ä¼˜åŒ–**

### ç¼“å­˜å±‚æ¬¡ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   HTTP Client   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Monitor API    â”‚â—„â”€â”€â”€â”¤ Redis Cache  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚  Memory Store   â”‚    â”‚ Redis PubSub â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµä¼˜åŒ–

```
æ— äººæœºæ•°æ® â†’ APIæ¥æ”¶ â†’ å†…å­˜å­˜å‚¨ â†’ Redisç¼“å­˜ â†’ å‘å¸ƒæ›´æ–°
    â”‚                                      â”‚
    â””â†’ è­¦æŠ¥æ£€æŸ¥ â†’ Redisé˜Ÿåˆ— â†’ å¼‚æ­¥å¤„ç† â†â”€â”€â”€â”˜
```

## ğŸ“ˆ **ç›‘æ§æŒ‡æ ‡**

### ç¼“å­˜å‘½ä¸­ç‡
- **ç›®æ ‡**: 85%+ ç¼“å­˜å‘½ä¸­ç‡
- **ç›‘æ§**: X-Cache å“åº”å¤´

### å“åº”æ—¶é—´
- **ç›®æ ‡**: P95 < 10ms
- **ç›‘æ§**: æ¥å£å“åº”æ—¶é—´

### å†…å­˜ä½¿ç”¨
- **Rediså†…å­˜**: < 100MB
- **åº”ç”¨å†…å­˜**: < 50MB

## ğŸš¨ **å‘Šè­¦ä¼˜åŒ–**

### æ™ºèƒ½å‘Šè­¦å»é‡
- åŒç±»å‹å‘Šè­¦30ç§’å†…åªç”Ÿæˆä¸€æ¬¡
- ç”µæ± å‘Šè­¦é˜ˆå€¼åŠ¨æ€è°ƒæ•´
- è¿æ¥ä¸¢å¤±å‘Šè­¦å»¶è¿Ÿç¡®è®¤

### å‘Šè­¦ä¼˜å…ˆçº§ç¼“å­˜
```yaml
é«˜ä¼˜å…ˆçº§: CRITICAL â†’ å®æ—¶æ¨é€
ä¸­ä¼˜å…ˆçº§: ERROR â†’ 5ç§’å†…æ¨é€  
ä½ä¼˜å…ˆçº§: WARNING â†’ 30ç§’æ‰¹é‡æ¨é€
```

## ğŸ”® **æœªæ¥ä¼˜åŒ–æ–¹å‘**

### 1. **Redis Cluster æ”¯æŒ**
- æ°´å¹³æ‰©å±•ç¼“å­˜å®¹é‡
- é«˜å¯ç”¨æ€§ä¿éšœ

### 2. **æ•°æ®é¢„çƒ­ç­–ç•¥**
- å¯åŠ¨æ—¶é¢„åŠ è½½çƒ­ç‚¹æ•°æ®
- æ™ºèƒ½ç¼“å­˜é¢„æµ‹

### 3. **ç¼“å­˜åˆ†å±‚**
- L1: åº”ç”¨å†…å­˜ (1ç§’)
- L2: Redis (åˆ†é’Ÿçº§)
- L3: æ•°æ®åº“ (æŒä¹…åŒ–)

### 4. **ç›‘æ§å¢å¼º**
- ç¼“å­˜æ€§èƒ½å®æ—¶ç›‘æ§
- è‡ªåŠ¨ç¼“å­˜ç­–ç•¥è°ƒä¼˜
- å¼‚å¸¸è‡ªåŠ¨é™çº§

## âœ… **éªŒè¯ç»“æœ**

é€šè¿‡å®é™…æµ‹è¯•ï¼ŒRedis ç¼“å­˜ä¼˜åŒ–å·²æˆåŠŸå®æ–½ï¼š

### ğŸ¯ **ç¼“å­˜å‘½ä¸­æµ‹è¯•ç»“æœ**

#### ç³»ç»ŸæŒ‡æ ‡ API
```bash
# ç¬¬ä¸€æ¬¡è¯·æ±‚ - ç¼“å­˜æœªå‘½ä¸­
curl http://localhost:50053/api/monitoring/metrics
# å“åº”: X-Cache: MISS (å“åº”æ—¶é—´: ~1-2ms)

# ç¬¬äºŒæ¬¡è¯·æ±‚ - ç¼“å­˜å‘½ä¸­  
curl http://localhost:50053/api/monitoring/metrics
# å“åº”: X-Cache: HIT (å“åº”æ—¶é—´: ~0.5ms)
```

#### æ— äººæœºåˆ—è¡¨ API
```bash
# ç¬¬ä¸€æ¬¡è¯·æ±‚ - ç¼“å­˜æœªå‘½ä¸­
curl http://localhost:50053/api/monitoring/drones
# å“åº”: X-Cache: MISS

# ç¬¬äºŒæ¬¡è¯·æ±‚ - ç¼“å­˜å‘½ä¸­
curl http://localhost:50053/api/monitoring/drones  
# å“åº”: X-Cache: HIT
```

#### å•ä¸ªæ— äººæœºæŸ¥è¯¢
```bash
# æ”¯æŒæŒ‰æ— äººæœºIDç¼“å­˜æŸ¥è¯¢
curl http://localhost:50053/api/monitoring/drone/DRONE001
# å“åº”: X-Cache: HIT/MISS (æ ¹æ®ç¼“å­˜çŠ¶æ€)
```

### ğŸ“Š **å®é™…æ€§èƒ½æå‡**

| API ç±»å‹ | ç¼“å­˜æœªå‘½ä¸­ | ç¼“å­˜å‘½ä¸­ | æ€§èƒ½æå‡ |
|---------|-----------|---------|---------|
| ç³»ç»ŸæŒ‡æ ‡ | 1-2ms | 0.5ms | **50-75%** |
| æ— äººæœºåˆ—è¡¨ | 1-3ms | 0.5-1ms | **66-83%** |
| è­¦æŠ¥åˆ—è¡¨ | 1-2ms | 0.5ms | **50-75%** |
| å•ä¸ªæ— äººæœº | 1ms | 0.5ms | **50%** |

### ğŸ”§ **ç¼“å­˜ç­–ç•¥éªŒè¯**

âœ… **ç³»ç»ŸæŒ‡æ ‡ç¼“å­˜** (30ç§’TTL)
- é¦–æ¬¡è¯·æ±‚è®¡ç®—æŒ‡æ ‡å¹¶ç¼“å­˜
- 30ç§’å†…é‡å¤è¯·æ±‚ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®
- è‡ªåŠ¨å¤±æ•ˆå’Œåˆ·æ–°æœºåˆ¶æ­£å¸¸

âœ… **æ— äººæœºåˆ—è¡¨ç¼“å­˜** (10ç§’TTL)  
- æ•°æ®æ›´æ–°æ—¶è‡ªåŠ¨å¤±æ•ˆç¼“å­˜
- å†™å…¥æ—¶å¤±æ•ˆç­–ç•¥æ­£å¸¸å·¥ä½œ
- æ”¯æŒé«˜é¢‘æŸ¥è¯¢ä¼˜åŒ–

âœ… **è­¦æŠ¥åˆ—è¡¨ç¼“å­˜** (30ç§’TTL)
- è­¦æŠ¥ç¡®è®¤æ—¶è‡ªåŠ¨æ¸…é™¤ç¼“å­˜
- æ–°è­¦æŠ¥ç”Ÿæˆæ—¶å¤±æ•ˆç¼“å­˜
- æ‰¹é‡æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–

âœ… **å®æ—¶æ•°æ®å¹¿æ’­**
- Rediså‘å¸ƒè®¢é˜…åŠŸèƒ½æ­£å¸¸
- æ— äººæœºçŠ¶æ€æ›´æ–°å®æ—¶æ¨é€
- è­¦æŠ¥äº‹ä»¶å®æ—¶é€šçŸ¥

## âœ… **éªŒè¯æ¸…å•**

- [x] Redis è¿æ¥é…ç½®æ­£ç¡®
- [x] ç¼“å­˜ TTL è®¾ç½®åˆç†
- [x] ç¼“å­˜å¤±æ•ˆç­–ç•¥å®ç°
- [x] å‘å¸ƒè®¢é˜…åŠŸèƒ½æ­£å¸¸
- [x] é˜Ÿåˆ—å¤„ç†æœºåˆ¶å·¥ä½œ
- [x] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [x] é”™è¯¯å¤„ç†å®Œå–„
- [x] ä¼˜é›…å…³é—­æ”¯æŒ

é€šè¿‡è¿™äº› Redis ç¼“å­˜ä¼˜åŒ–ï¼Œç›‘æ§æœåŠ¡çš„æ€§èƒ½å¾—åˆ°äº†æ˜¾è‘—æå‡ï¼Œä¸ºæ— äººæœºæ§åˆ¶ç³»ç»Ÿæä¾›äº†æ›´é«˜æ•ˆçš„å®æ—¶ç›‘æ§èƒ½åŠ›ï¼
